---
import Layout from "../../layouts/Layout.astro";
---

<Layout>
  <h1 class="text-2xl font-bold text-center text-purple-600 m-4">
    Cars Filtre
  </h1>

  <div class="my-6">
    <label for="cylinders" class="font-medium text-pink-700 mr-2"
      >Choisir le nombre de cylindres :</label
    >
    <select
      name="cylinders"
      id="cylinders"
      class="border border-pink-400 rounded px-3 py-2 bg-white text-black focus:outline-none focus:ring-2 focus:ring-purple-300 shadow-sm"
    >
      <option value="">Tous</option>
      <option value="4">4</option>
      <option value="6">6</option>
      <option value="8">8</option>
    </select>
  </div>

  <div id="myplot"></div>
</Layout>

<script >
  import * as Plot from "@observablehq/plot";
  import cars from "../../assets/cars.json"; // ton JSON complet de voitures

  const selectCylinders = document.getElementById("cylinders");
  const plotDiv = document.getElementById("myplot");

  function renderPlot() {
    const cyl = selectCylinders.value;
    const filtered = cyl
      ? cars.filter((d) => d.cylinders === Number(cyl))
      : cars;

    plotDiv.innerHTML = "";

    if (filtered.length === 0) {
      plotDiv.textContent = "Aucune donnÃ©e pour ce filtre.";
      return;
    }

    const plot = Plot.plot({
      width: 2000,
      height: 420,
      marks: [
        Plot.barY(filtered, {
          x: "name", // chaque voiture sur l'axe X
          y: "power (hp)", // hauteur = puissance
          fill: "cylinders", // couleur par nombre de cylindres
          title: (d) =>
            `${d.name}\nCylinders: ${d.cylinders}\nPower: ${d["power (hp)"]} hp\nWeight: ${d["weight (lb)"]} lb\n0-60 mph: ${d["0-60 mph (s)"]} s\nYear: ${d.year}`,
        }),
      ],
      y: { label: "Power (hp)" },
      x: { label: "Car", rotate: -45, tickSize: 0 },
    });

    plotDiv.appendChild(plot);
  }

  selectCylinders.addEventListener("change", renderPlot);
  renderPlot();
</script>
